# Trade Guide 任务清单

> **使用说明**: 每完成一个任务请勾选 `[x]`，这是我们的开发进度追踪表

## 📋 Phase 0: 数据准备 (Day 0-1)

- [x] 确认 25 种商品及重量
- [x] 确认 20 城市名称 (古风) 与 3 款可买商品初始映射（允许交集，可后续动态调整）
- [x] 初始城市拓扑（直接连接边集合 + 距离）
- [x] 生成 mock 价格 JSON  
- [x] 设计审计日志数据结构
- [x] PIN码验证逻辑设计（4位数字）
- [x] 创建数据库初始化SQL
- [x] 创建TypeScript类型定义

## 🧮 Phase 1: 核心算法 (Day 1-2)

- [ ] TypeScript 接口定义
- [ ] 直接相邻枚举单次最优计算函数 + 单元测试
- [ ] PIN码加密存储与验证算法
- [ ] 算法性能测试（目标 < 100ms）

## 🎨 Phase 2: 前端基础 (Day 2-4)

### 项目初始化
- [ ] Vite+Vue3+TypeScript 项目骨架
- [ ] ESLint + Prettier + 路径别名配置
- [ ] UnoCSS 配置与基础样式
- [ ] Pinia 状态管理设置

### 核心组件
- [ ] 路由 / Tab 布局
- [ ] 价格录入页面 (25行商品表格)
- [ ] 计算页面 (参数输入 + 结果展示)
- [ ] 商品配置页面 (城市列表 + 商品选择器)
- [ ] 用户登录组件 (用户名 + PIN码输入)

### 状态管理
- [ ] userStore（username, pin, approved, isAdmin）
- [ ] cityStore（currentCityId, cities, products config）
- [ ] priceStore（价格 Map + 更新方法 + 脏状态）
- [ ] graphStore（edges, version；无需最短路缓存，仅直接边查询）

## 🔗 Phase 3: 后端集成 (Day 4-6)

### 数据库设计
- [ ] Supabase 项目创建
- [ ] 用户表 (User) 创建
- [ ] 价格表 (PriceRecord) 创建  
- [ ] 审计表 (AuditLog) 创建
- [ ] 城市表 (City) 创建
- [ ] 边表 (Edge) 创建
- [ ] RLS 权限策略配置

### API服务层
- [ ] supabaseClient.ts 初始化
- [ ] userService.ts （注册、审批、PIN验证）
- [ ] priceService.ts （价格 CRUD + 批量更新）
- [ ] cityService.ts （城市管理 + 商品配置）
- [ ] auditService.ts （日志记录 + 查询）
- [ ] graphService.ts （拓扑管理：城市增删改名、边增删改、距离修改）
- [ ] productService.ts （商品增删与改名，更新受影响城市配置）

### 功能集成
- [ ] 用户注册申请流程
- [ ] PIN码设置与验证
- [ ] 管理员审批界面
- [ ] 价格录入与保存
- [ ] 城市商品配置修改
- [ ] 审计日志记录与查看
- [ ] 拓扑编辑（管理员：城市增删改名 / 边增删改 / 距离修改 / 商品增删改名）

## 🚀 Phase 4: 打磨上线 (Day 6-7)

### 用户体验优化
- [ ] 加载动画与状态指示
- [ ] 错误处理与用户提示
- [ ] 数据时间高亮（>60分钟黄色、>90分钟红色）
- [ ] 移动端适配测试
- [ ] PIN码输入体验优化（数字键盘、自动提交）

### 审计功能完善
- [ ] 按用户查看操作历史组件
- [ ] 按城市商品变化查看组件  
- [ ] 按价格变化查看组件
- [ ] 审计数据分页与筛选
- [ ] 我的页面（个人信息 + 操作记录）

### 性能与安全
- [ ] 算法结果缓存策略
- [ ] 价格数据实时同步（轮询60s）
- [ ] PIN码安全存储（bcrypt加密）
- [ ] 输入验证与防护
- [ ] API访问频率限制

### 部署上线
- [ ] Vercel 项目配置
- [ ] 环境变量设置
- [ ] 生产构建测试
- [ ] Lighthouse性能测试（目标>90分）
- [ ] PWA Manifest配置
- [ ] 域名绑定与SSL

## 🧪 测试与文档

### 单元测试
- [ ] graph.spec.ts (直接边数据结构测试)
- [ ] strategy.spec.ts (直接相邻枚举策略算法测试)
- [ ] direct-trip.spec.ts (单次直达最优组合测试)
- [ ] auth.spec.ts (PIN码验证测试)
- [ ] validators.spec.ts (输入验证测试)

### 集成测试  
- [ ] 用户注册登录流程
- [ ] 价格录入与查询流程
- [ ] 城市配置修改流程
- [ ] 审计日志记录流程

### 文档更新
- [ ] API接口文档
- [ ] 部署指南更新
- [ ] 用户使用说明
- [ ] 开发环境搭建指南

## 📱 移动端优化

- [ ] 触摸手势优化
- [ ] 虚拟键盘适配
- [ ] PWA添加到桌面测试
- [ ] 离线缓存策略
- [ ] 网络断线重连处理

## 🔍 可选增强项 (优先级较低)

- [ ] 价格异常检测算法
- [ ] 数据导出功能  
- [ ] 高级统计分析
- [ ] 多语言支持准备
- [ ] 深色模式支持

## 📊 验收标准

### 功能完整性
- [ ] 所有5个页面正常工作
- [ ] 用户登录PIN码验证正常
- [ ] 价格录入与计算功能正常
- [ ] 管理员功能（审批、城市管理、审计）正常
- [ ] 普通用户功能（价格录入、商品配置）正常

### 性能指标
- [ ] 算法计算时间 < 100ms
- [ ] 页面加载时间 < 2s  
- [ ] Lighthouse移动端评分 > 90分

### 安全标准
- [ ] PIN码加密存储
- [ ] 用户权限隔离正确
- [ ] 审计日志记录完整
- [ ] 输入验证无漏洞

---

**进度跟踪**: 
- 总任务数: ~80+
- 已完成: 0
- 进度: 0%

**当前状态**: Phase 0 - 数据准备阶段
